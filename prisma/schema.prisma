// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  avatar        String?
  role          String    @default("user")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  leads         Lead[]
  deals         Deal[]
  tasks         Task[]
  campaigns     Campaign[]
  activities    Activity[]
}

model Lead {
  id            String    @id @default(cuid())
  company       String
  contactName   String
  contactEmail  String?
  contactPhone  String?
  temperature   String    @default("warm") // hot, warm, cold
  dealValue     Float?
  rating        Int       @default(0)
  status        String    @default("new") // new, contacted, qualified, converted, lost
  notes         String?
  assignedToId  String?
  assignedTo    User?     @relation(fields: [assignedToId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  deals         Deal[]
  activities    Activity[]
  
  @@index([assignedToId])
  @@index([temperature])
  @@index([status])
}

model Deal {
  id            String    @id @default(cuid())
  company       String
  value         Float
  stage         String    // prospecting, qualified, proposal, negotiation, closed-won, closed-lost
  probability   Int       @default(0)
  ownerId       String
  owner         User      @relation(fields: [ownerId], references: [id])
  leadId        String?
  lead          Lead?     @relation(fields: [leadId], references: [id])
  expectedClose DateTime?
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  activities    Activity[]
  
  @@index([ownerId])
  @@index([stage])
  @@index([leadId])
}

model Campaign {
  id            String    @id @default(cuid())
  name          String
  description   String?
  type          String    // email, social, sms, etc.
  status        String    @default("draft") // draft, active, paused, completed
  startDate     DateTime?
  endDate       DateTime?
  createdById   String
  createdBy     User      @relation(fields: [createdById], references: [id])
  sent          Int       @default(0)
  opened        Int       @default(0)
  clicked       Int       @default(0)
  converted     Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([createdById])
  @@index([status])
}

model Task {
  id            String    @id @default(cuid())
  title         String
  description   String?
  status        String    @default("todo") // todo, in-progress, completed
  priority      String    @default("medium") // low, medium, high
  category      String?
  dueDate       DateTime?
  assignedToId  String
  assignedTo    User      @relation(fields: [assignedToId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([assignedToId])
  @@index([status])
  @@index([priority])
}

model Activity {
  id            String    @id @default(cuid())
  type          String    // call, email, meeting, note, etc.
  title         String
  description   String?
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  leadId        String?
  lead          Lead?     @relation(fields: [leadId], references: [id])
  dealId        String?
  deal          Deal?     @relation(fields: [dealId], references: [id])
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([leadId])
  @@index([dealId])
  @@index([createdAt])
}

